# 有向图
在有向图中，边是单向的：每条边所链接的两个顶点都是有序对，他们的链接是单向的。
## 4.2.1 术语
定义，有向图是由一组顶点和一组有方向的边组成的，每条有方向的边都链接着有序的一对顶点。

+ 我们称，一条有向边由第一个顶点指出并指向第二个顶点。
+ ！出度 在一幅有向图中，一个顶点的出度为由该顶点指出的边的总数。
+ ！入度 一个顶点为指向该顶点边的总数
+ 头 一条有向边的第一个顶点
+ 尾 一条有向边的第二个顶点

一幅有向图里的两个顶点可能有以下四种关系
+ 没有边相连
+ 存在v->w
+ 存在w->v
+ 双向链接，都存在

定义，在一幅有向图中
+ 有向路径 由一系列顶点组成，对于其中某个顶点都存在一条有向边从它指向下一个顶点。
+ 有向环 一条至少含有一条边且起点和终点相同的有向路径
+ 简单有向环 一条（除了起点和终点相同）不含有重复的顶点和边的环
+ 路径或者环的长度即为其包含的边的总数

必须理解有向图中的可达性和无向图的连通性的区别。
## 4.2.2 有向图的数据类型
### 4.2.2.1 有向图的表示
还是使用链接表表示有向图
### 4.2.2.2 输入格式（从输入流读取）
### 4.2.2.3 有向图取反
将其中所有边的方向反转，因为这样可以找出 "指向" 每个顶点的所有边 而adj 只会给出
每个顶点发出的边
### 4.2.2.4 顶点的符号名
## 4.2.3 有向图中的可达性
有深度搜索即可完成单个顶点是否可达性的问题。

在添加一个构造DirectedDFS(Digraph g,Iterable<Integer> sources),在g中
找到从sources可达的所有顶点。

在添加了这个构造后，可回答多点可达性的问题，即是否存在一条从集合中的任意顶点到指定顶点的有向路径？

命题D ， 在有向图中，深度优先搜索标记 由一个集合的顶点可达的所有顶点所需的时间 与被标记的所有顶点的出度之和成正比
证明， 同命题A

深度优先适用于有向图，因为每条边只会表示一次
### 4.2.3.1 标记- 清除的垃圾收集
多点可达性实际应用在内存管理中，一个顶点表示一个对象，一条边表示一个对象对另一个对象对引用。
### 4.2.3.2 有向图的寻路
## 4.2.4 环和有向无环图
在和有向图的实际运用中，有向环特别重要。
### 4.2.4.1 调度问题
一种应用广泛的模型是给定一组任务并安排他们的执行顺序，条件是执行方法和其实时间，以及耗时和资源，最重要的限制条件是优先级。

优先级限制下的调度问题。有向图，顶点对应任务，边对应优先级顺序。优先级限制下的调度问题等价于以下问题：

拓扑排序，给定一幅有向图，将所有顶点排序，使得所有的有向边均从排在前面的元素指向排在后面的元素（或者说明无法做到）
            
            拓扑排序的典型应用
    应用          顶点          边
    任务调度       任务          优先级限制
    课程安排       课程          先导课程限制
    继承          Java类        extends
    电子表格       单元格cell     公式
    符号链接       文件名         链接
### 4.2.4.2 有向图中的环
如果一个优先级限制的问题里存在环，那么这个问题肯定是无解的。

有向环检测。一幅有向图中含有的环的数量可能是图的大小的指数级别，因此只需找出一个环即可。

定义，有向无环图。一幅不含有环的图。

深度优先搜索，如果存在逆向的边，既是有环。
### 4.2.4.3 顶点的深度优先次序 与 拓扑排序
优先级别问题，等价于计算有向无环图中的所有顶点的拓扑排序

命题E 当且仅当一幅有向图是无环图才能进行拓扑排序

使用深度优先来排序，将dfs的参数顶点保存在一个数据结构，遍历此结构，就能得到所有顶点。
遍历的顺序取决于这个数据结构的性质以及递归调用之前还是之后保存进数据结构。
+ 前序，加入队列，就是dfs的调用顺序
+ 后序，加入队列，遍历完成的顺序
+ 逆后序，压入栈，后续的逆转顺序

命题F ，一幅有向无环的拓扑排序 即为 所有顶点的逆向排序

证明 对于任意边 v -> w 调用dfs（v）以下三种情况必定成立其一
+ dfs（w）已经被调用且返回过 （w被标记）
+ dfs（w）还没有被调用，调用dfs（w），并且会在dfs（v）之前返回
+ dfs（w）已经被调用但是没有返回。证明，这种情况在无环图里不可能出现。
由于递归调用链，意味着存在从w到v的路径，但又存在从v到w，这是一个环。首先这是无环的。

命题G 使用深度优先搜索对无环图进行拓扑排序所需时间与V+E成正比

还有用队列存储顶点的方式比较流行。

在实际运用中，拓扑排序和检测环总是一起出现，因为检测环为前提。
因此解决任务调度一般需要以下步骤
+ 指明任务和优先级条件
+ 不断检测并去除有向图中的环
+ 使用拓扑排序解决问题
## 4.2.5 有向图中的强连通性（有向图里的环处理）
定义，如果在一个有向图里，v和w是互相可达的，则称它们为强连通的，则称有向图也是强连通的。

两个顶点是强连通的，当且仅当它们都在一个普通的有向环中（证明：画出从V到W和从V到W的路径即可）。

### 4.2.5.1 强连通分量
和无向图中连通性一样，有向图中的强连通性也是一种顶点之间平等关系。它们有以下性质：
+ 自反性
+ 对称性
+ 传递性

强连通性将所有顶点分为一些平等的部分，每个部分都是由相互均为强连通的顶点的最大子集组成。我们将这种子集称为强连通分量。

一个含有V个顶点的有向图含有 1 - v个强连通分量，一个强连通图只含有一个强连通分量，而一个 无环有向图里 有 V个强连通分量。

需要注意连通分量的定义是基于顶点，而不是边。
### 4.2.5.2 应用举例
强连通性是一种很重要的抽象，突出了相互关联的几组顶点。比如，把哪些话题归为一类，程序的模块话，食物链模型。

平方级别的算法肯定不能接受。
### 4.2.5.3 Kosaraju算法
cc中有过计算无向图中的分量，是基于深度优先。而Kosaraju算法将完成以下任务
+ 在给定的一幅有向图中，使用深度优先排序计算反向图的逆后序排列
+ 根据排序出来的逆后序，标记顶点
+ 所有在一个递归dfs中的顶点

命题H ，使用深度优先搜索查找给定有向图G的反向图R，根据由此得到的所有顶点的逆后序，再次使用深度优先搜索处理
有向图，并将每一次递归调用标记的顶点放在一个连通分量。

证明，首先证明 每个和S强连通的顶点V都会在调用dfs（G，s）中被访问；（反证法）因为是强连通，肯定会调用到dfs（G，V）。
其次证明调用dfs（g，s）所到达的任意顶点v必然和s连通。假设v是其中一个顶点，首先必然有一条s通向v，因此还需证明的是v通向s，也就是g的逆向图里，有一条s到v。。。。的路径。

因此，按照后逆序进行的深度优先搜索意味着，调用dfs（g，v）必然在dfs（g，s）之前结束返回。因此dfs（g，v）会有两种情况
+ 调用在dfs（g，s）的调用之前
+ 调用在dfs（g，v）的调用之后

第一种情况不可能，因为逆向图R里存在着v到s的路径，而第二种情况说明存在s到v，sv是强连通的

命题I kosaraju算法的预处理时间和空间与V + E成正比 且支持常数时间的有向图强连通性查询
### 4.2.5.4 可达性
在CC类里，如果vw连通，必然存在着一条路径。而对于有向图，如果两个顶点是非强连通，那么他们之间的路径
+ 可能存在 v-w
+ 可能存在 w-v
+ 可能啥都不存在

可达性可以回答是否存在给定的路径。

对于无向图，这个等价于连通性。对于有向图，就有区别了。

定义 T ，有向图 G 的传递闭包（V*V） 是由相同的一组顶点组成的另一幅有向图，在传递闭包中存在一条从v指向w的边，当且仅当G中w是从v可达的。

## 4.2.6 总结
+ 有向图的术语
+ 有向图的表示和算法在本质上和无向图是相同的，但部分更复杂
+ 有向图，有向无环图，拓扑排序，优先级的问题
+ 有向图的可达性，路径，强连通性

                            本节中处理的有向图的API
        问题                      解决方法                     
        单点和多点的可达性           DirectedDFS
        单点有向路径                DFSPaths
        单点最短有向路径             BreadPath
        有向环检测                  Cycle
        深度优先排序                 DFSOrder(有三种)
        优先级限制下的调度问题         Topological
        强连通性(逆后序图的dfs调用)    KosarajoSCC
        顶点对的可达性（闭包，不理想）
        
        











    
            






