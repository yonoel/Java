# 3.2 二叉查找树
使用每个节点含有两个链接的二叉查找树来高效地实现符号表

术语：我们使用的数据结构由节点组成，节点包含的链接可以指向null或者其他节点，
在二叉树中，每个节点只能有一个父节点指向自己（除了根节点），每个节点都只有
左右两个链接，指向自己的左右子节点。尽管链接指向的是节点，但我们可以将每个链接
看作指向了另一棵二叉树，而这棵树的根节点就是被指向的节点。因此我们可以将
二叉树定义为一个空链接，或是一个有左右两个链接的节点，每个链接都指向子二叉树。

在二叉查找树中，每个节点包含了一个键和一个值，键之间也有顺序之分以支持高效的查找。

定义。一棵二叉查找树（BST）是一棵二叉树，每个节点都含有一个Comparable的键，以及
相关联的值，且每个节点的键都大于左子树中的任意节点的键，而小于右子树的任意节点的键

## 3.2.1 基本实现
### 3.2.1.1 数据表示 
一棵二叉查找树代表了一组键及值的集合，而同一个集合，可以用多棵不同的二叉树来表示
### 3.2.1.2 查找
去看BST代码，put和get的递归
### 3.2.1.3 插入
### 3.2.1.4 递归
递归就像沿着树趴下去，
对于get，return意味着沿着树返回
对于put，return意味着重置搜索路径上每个父节点指向子节点的链接，并增加路径上每个节点中的计数器的值
## 3.2.2 分析
使用二叉查找树的算法运行时间取决于树形状，而树形状取决于键被插入的先后顺序

在最好情况下，N个节点的树是完全平衡的，每条空链接和根节点的距离都为LgN，最坏
情况就是单侧有N个节点。

二叉查找树和快速排序几乎是上备胎，根节点就是第一个切分元素。

命题C，在由N个随机键构造的二叉查找树里，查找命中的平均所需比较次数为～2InN(1.39LgN)

证明。见2。3节对快速排序的分析

说明二分查找树的查找成本比二分查找高约39%，但是插入一个新键的成本是对数级别的，以及
高于二分查找的有序数组

实验

我们使用FrequencyCounter进行实验，当处理长度大于等于8的单词时，
其中put方法从BinarySearchST的484次降低到了二叉查找树的13次，然而有一些现实问题
+ 很多操作都是在较小的符号表
+ 键不随机
+ 符号表可能太小，近似值2InN不准确
## 3.2.3 有序性相关的方法与删除操作
二叉查找树得以广泛运用的另一个原因就是它能保持键的有序性，因此不仅能通过键访问，也能通过键的相对顺序访问键值对

### 3.2.3.1 最大键和最小键
最小键必然是左侧节点为空的根节点
### 3.2.3.2 向下取整和向上取整
如果给定的key小于根节点的键，那么小于等于key的最大键一定在左子树
### 3.2.3.3 选择操作
select
### 3.2.3.4 排名
rank
### 3.2.3.5 删除最大和最小键
删最小：递归直到左侧没有节点，然后把指向该节点的节点指向该节点的右节点
### 3.2.3.6 删除操作
删除任意只有一个子节点的节点，类似上面的方法，但是如果删除一个有两个子节点的节点呢？
删除之后我们要处理两棵子树，但只有一个节点链接。

T.Hibbard 1962年提出了解决这个问题的第一个方法。在删除节点后，用它的后继节点填补它的位置。
因为X有一个右子节点，因此它的后继节点就是其右子树中最小的节点，这样替换仍能保证树的有序性。
+ 将指向即将被删除的节点的链接保存为t；
+ 将x指向它的后继节点min（t.right）
+ 将x的右链接（原本指向一棵所有节点都大于x.key的二叉查找树）指向deleteMin(t.right),
也就是在删除后所有节点仍然大于x.key的子二叉查找树
+ 将x的左链接（本为空）设为t.left （其下所有的键都小于被删除的节点和它的后继节点）

我们需要修正被删除的节点的父节点的链接，并将所有节点的计数器-1。

尽管这种方法能正确删除节点，但性能很差。因为在于选用后继节点是一个随意的决定，且没有
考虑树的对称性。比如可以使用它的前继节点么？

一般情况下这段代码效率不粗，但是大规模应用性能就有问题了
### 3.2.3.7 范围查找
首先需要一个遍历二叉查找树的基本方法，中序遍历。先写个方法，按序打印所有的键，
比如先打印根节点的左子树里所有的键,在打印出根节点的键，在打印右侧的键

接下来，就是实现两个参数的方法，将所有落在给定范围内的键加入一个queue，并跳过
那些不可能含有查找键的树。(这一节的方法基本都是递归调用，声明一个具体实现，然后在
细节里全用递归，分类，解决问题，归约)

### 3.2.3.8 性能分析
二叉查找树中和有序性相关的操作的性能，首先要知道树的高度

命题E:在一棵二叉树中，所有操作在最坏情况下所需的时间都和树的高度成正比

总的来说，实现二叉查找树并不困难，且树的构造和随机模型越是近似，越是快速（越倾向于平衡二叉树）。
支持高效的rank，select，delete以及范围查找，

    简单符号表实现的成本总结
    
    算法（数据结构）            最坏情况的增长数量级别             平均情况的增长数量级别             是否支持有序性
                             查找       插入                  查找命中      插入
    顺序查询（无序链表）         N          N                     N/2         N                   否
    二分查找(有序数组)          lgN        N                     lgN         N/2                 是
    二叉查找树                 N         N                      1.39LgN      1.39lgN             是
    
# Q & A
    





